<!DOCTYPE html>
{% load staticfiles %} <html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <link href="{% static "css/bootstrap.min.css"%}" rel="stylesheet">
  <link href="{% static "css/bootstrap-responsive.min.css"%}" rel="stylesheet">
  <link href="{% static "css/style.css"%}" rel="stylesheet">

  <script type="text/javascript" src="{% static "js/jquery.min.js"%}"></script>
  <script type="text/javascript" src="{% static "js/bootstrap.min.js"%}"></script>
  <script type="text/javascript" src="{% static "js/scripts.js"%}"></script>

  <title> {{ name }} | Home </title>

</head>
<body>
<div class="container-fluid">
  <div class="row-fluid">
    <h3>
    A Framework for Setting and Assessing Programming Exercises </h3>
    <div class="span2">
      <script>
        $(document).ready(function () {
          $('ul.menu-list').toggle();
          $('label.tree-toggler').click(function () {
           $(this).parent().children('ul.tree').toggle(200);
         });
        });
        </script>
      <ul class="nav nav-list">
        <li class="nav-header"> Menu </li>
        <li class="active">
          <a href="#">Code</a>
          {% for chapter in assignments.get_chapters %}
            <ul class="nav nav-list">
              <li><label class="tree-toggler nav-header"> {{ chapter.get_name }}</label>
              <ul class="nav nav-list tree menu-list">
                {% for assignment in chapter.get_assignments %}
                  <li><a href="/code-single-exercise/{{assignment.get_id}}">{{ assignment.get_name }}</a></li>
                {% endfor %}
              </ul>
              </li>
            </ul>
          {% endfor %}
        </li>
        <li>
          <a href="/student-grades/">Grades</a>
        </li>
      </ul>
    </div>
    <div class="span9">
      <div class="well" style=" padding: 8px 0;">
        <ul class="nav nav-list">
        {% for chapter in assignments.get_chapters %}
          <li><label class="tree-toggler nav-header">{{ chapter.get_name}}</label>
          <ul class="nav nav-list tree">
            {% for assignment in chapter.get_assignments %}
              <li><a href="#" id="{{ chapter.get_name }}-{{ assignment.get_name }}">{{ assignment.get_name }}</a></li>
              <div id="{{ chapter.get_name }}-{{ assignment.get_name }}-ex">
                <div class="panel panel-default">
                  <div class="panel-body">
                    <form accept-charset="UTF-8"  method="POST">
                      {% csrf_token %}
                      {{ assignment.get_code.non_field_errors }}
                      {{ assignment.get_code.code.errors }}
                      {{ assignment.get_code.code }}
                      <br>
                      <button class="btn btn-info" onclick="check({{assignment.get_id}})">Submit</button>
                      <div id="ok_{{assignment.get_id}}">Ok!</div>
                      <div id="wrong_{{assignment.get_id}}">X</div>
                    </form>
                  </div>
                </div>
              </div>
            {% endfor %}
          </ul>
          </li>
        {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>
</div>
<script>
var divsNames = new Array();
divsNames = [];
{% for chapter in assignments.get_chapters %}
  {% for assignment in chapter.get_assignments %}
    divsNames.push("{{ chapter.get_name }}-{{ assignment.get_name }}");
    $('#wrong_{{assignment.get_id}}').hide();
    $('#ok_{{assignment.get_id}}').hide();
  {% endfor %}
{% endfor %}

hideAll();
addClickHandlers();
function hideAll() {
  for (var i = 0; i < divsNames.length; i++) {
    $('#' + divsNames[i] + '-ex').hide();
  }
}
function addClickHandlers() {
  for (var i = 0; i < divsNames.length; i++)
  {
    $('#' + divsNames[i]).click(function (event)
    {
      $('#' + event.currentTarget.id + '-ex').toggle(300);
    });
  }
}

function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie != '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) == (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

var csrftoken = getCookie('csrftoken');

function check(ex_id) {
  alert(ex_id);
  $.ajax({
        type: 'POST',
        url: '/submit-code/'+ex_id+"/",
        datatype: 'json',
        data: {
                'code': $('id_code_'+ex_id).val()
              },
        beforeSend: function(xhr, settings) 
              {
                xhr.setRequestHeader("X-CSRFToken", csrftoken);
              },
        success: function(response) 
              {
                alert(response);
                if(response=="ok")
                {
                  alert("submission done");
                  $('#wrong_'+ex_id).hide();
                  $('#ok_'+ex_id).show();
                } else 
                {
                  alert("wrong");
                  $('#ok_'+ex_id).hide();
                  $('#wrong_'+ex_id).show();
                }
              }
    });
}

</script>
</body>
</html>
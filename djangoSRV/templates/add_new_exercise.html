<!DOCTYPE html>
{% load staticfiles %}
{% load selectable_tags %}
<html lang="en">
<head>
  {{ header }}
  {% include_ui_theme %}
  {% include_jquery_libs %}
   <script type="text/javascript" src="{% static "js/get_csrf_token.js"%}"></script>
</head>
 <body>
	{{ navbar }}
	<div class="container-fluid row-fluid">
		<div class="span12">
	    	{{ menu }}
	    	<div class="span3">
				<div class="well" style=" padding: 8px 0;">
					<ul class="nav nav-list">
						<li><label class="tree-toggler nav-header" id="title">Custom questions</label>
							<ul class="nav nav-list tree">		
									<li><a href="#" onclick="get_exercise_details(1)"> Question 1</a></li>
									<li><a href="#" onclick="get_exercise_details(2)"> Question 2</a></li>
							</ul>
						</li>
					</ul>
				</div>

				<a style="cursor:pointer;" id="new_question"><i class="glyphicon glyphicon-plus"></i>New custom question</a>
			</div>
			<div class="span5">
				<div id="spec">
					<i>Question</i>
					<br>
					<div id="description"></div>
					<br>
					<pre id="code" class="prettyprint lang-python"> </pre>
				</div>

				<div id="new_question_form">
					<form>
						{% csrf_token %}
						<i>Question</i>
						<br>
						{{new_ex.media}}
						{{new_ex.non_field_errors}}
						{{new_ex.description.errors}}
						{{new_ex.description}}
						<br><br>
						<i>Code</i>		
						<br>
						{{new_ex.code.errors}}
						{{new_ex.code}}
						<br><br>
						<i>Sample Solution</i>
						<br>
						{{new_ex.sample_answer.errors}}
						{{new_ex.sample_answer}}
						<br><br>
						<button id="cancel" class="btn btn-primary">Cancel</button>
						<button id="save" class="btn btn-primary">Save</button>
						<br>
						<br>
						<br>
					</form>
				</div>

				<div id="confirmation"></div>
			</div>
		</div>
	</div>

	<script>
		$("#spec").hide();
		$("#confirmation").text("");

		function get_exercise_details(ex_id)
		{
			var csrftoken = getCsrfToken();
			$.ajax({
		        type: 'GET',
		        url: "/teacher/get-exercise/",
		        data: {
		                'ex_id': ex_id
		              },
		        beforeSend: function(xhr, settings) 
		              {
		                xhr.setRequestHeader("X-CSRFToken", csrftoken);
		              },
		        success: function(response) 
		              {
		              	var result = response.split("$%$");
		              	if (result.length == 1)
		              	{
			            	alert("Something went wrong. Please come back later");
			            }
			            else
			            {
			            	display_exercise_details(result[1], result[0]);
			            }
		              }
		    });
		}

		function display_exercise_details(description, code)
		{
			$("#description").text(description);
			$("#code").text(code);
			$("#spec").fadeIn("slow");
			$("#confirmation").text("");
		}

		$("#title").click(function () {
			$("#spec").fadeOut("slow");
			$("#confirmation").text("");
		});
		
		$("#new_question").click(function () {
			$("#spec").fadeOut("slow");
			$("#confirmation").text("");
		});

		$("#cancel").click(function () {
			$("#new_question_form").fadeOut("slow");
			$("#confirmation").text("");
		});

		$("#save").click(function () {
			var conf = "The custom question '" + $("#question_editor").val() + "'has been saved, along with the following code: " + $("#code_editor").val();
			$("#confirmation").text(conf);
		});

	</script>
</body>
</html>
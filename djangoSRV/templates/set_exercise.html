<!DOCTYPE html>
{% load staticfiles %}
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">

	<link href="{% static "css/bootstrap.min.css"%}" rel="stylesheet">
	<link href="{% static "css/bootstrap-responsive.min.css"%}" rel="stylesheet">
	<link href="{% static "css/style.css"%}" rel="stylesheet">

	<script type="text/javascript" src="{% static "js/jquery.min.js"%}"></script>
	<script type="text/javascript" src="{% static "js/bootstrap.min.js"%}"></script>
	<script type="text/javascript" src="{% static "js/scripts.js"%}"></script>

	<title> {{name}} | Teaching Overview </title>
</head>

<body>
	<div class="container-fluid">
		<div class="row-fluid">
			<div class="span12">
				<h3>
					A Framework for Setting and Assessing Programming Exercises
				</h3>
				<div class="row-fluid">
					<div class="span2">
						<ul class="nav nav-list">
							<li class="nav-header">
								Menu
							</li>
							<li>
								<a href="/teacher_view/">Overview</a>
							</li>
							<li class="active">
								<a href="#">Set exercise</a>
							</li>
							<li class="nav-header">
							</ul>
						</div>
						<div class="span10">
							<legend>Set an exercise</legend>

							<label>Choose exercise</label>
							<script>
							$(document).ready(function () {
								$('label.tree-toggler').click(function () {
									$(this).parent().children('ul.tree').toggle(300);
								});
									//$('.tree').hide();
									$('#selection-text').hide();
									$('#submit-btn').attr('disabled', 'disabled');
								});
							</script>
							<div class="span5">
								<div class="well" style=" padding: 8px 0;">
									<div style="">
										{% for chapter in assignment_book.get_chapters %}
											<ul class="nav nav-list">
											<li><label class="tree-toggler nav-header" id="{{ chapter.get_name }}">{{ chapter.get_name }}</label>
												<ul class="nav nav-list tree">
												{% for assignment in chapter.get_assignments %}
													<li><a href="#" id="{{ chapter.get_name }}-{{ assignment.get_name }}"> {{ assignment.get_name }}</a></li>
												{% endfor %}
												</ul>
											</ul>
										{% endfor %}
									</div>
								</div>
							</div>
							<div class="span5">
								<label>Choose class</label>
								<div class="well" style=" padding: 8px 0;">
									<div style="">
										{% for year in teaching_hierarchy.get_teaching_years %}
											<ul class="nav nav-list">
												<li><label class="tree-toggler nav-header">Year {{ year.name }}</label>
												<ul class="nav nav-list tree">
												{% for cls in year.get_teaching_classes %}
													<li><a href="#" id="year-{{ year.get_name }}-class-{{ cls.get_name }}">Class {{cls.get_name}}</a></li>
												{% endfor %}
												</ul>
											</li>
											</ul>
										{% endfor %}
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="container-fluid">
		<div class="row-fluid">
			<div class="span12">
				<div class ="span2"></div>
				<div class="span10">
					<div id="selection-text"></div>
					<br>
					<form>
						<button onclick="submit" type="submit" class="btn" id="submit-btn">Send</button>
					</form>
				</div>
			</div>
		</div>
	</div>

	<script>
	var exercise = "";
	var group = "";
	var text = $('#selection-text');
	var exercises = new Array();
	var exercisesDivs = new Array();
	var groups = new Array();
	var groupsDivs = new Array();
	var hlE = false, hlG = false;

	{% for year in teaching_hierarchy.get_teaching_years %}
		{% for cls in year.get_teaching_classes %}
			groupsDivs.push("year-{{ year.get_name }}-class-{{ cls.get_name }}");
			groups.push("{{ year.get_name }}{{ cls.get_name }}");
		{% endfor %}
	{% endfor %}

	{% for chapter in assignment_book.get_chapters %}
		{% for assignment in chapter.get_assignments %}
			exercises.push("{{ assignment.get_name }}");
			exercisesDivs.push("{{ chapter.get_name }}-{{ assignment.get_name }}");
		{% endfor %}
	{% endfor %}

	for (i = 0; i < exercisesDivs.length; i++) {
		$(("#" + exercisesDivs[i])).click(function (event) {

			target = "#" + event.currentTarget.id;
			
			if ($(target).css("background-color") == "rgb(255, 176, 122)") {
				$(target).attr("style", false);
				hlE = false;
				exercise = "";
				set();
			} else if (!hlE) {
				$(target).css("background-color","#ffb07a");
				hlE = true;
				exercise = exercises[exercisesDivs.indexOf(event.currentTarget.id)];
				set();
			} else {
				clean(exercisesDivs);
				hlE = false;
				$(target).css("background-color","#ffb07a");
				hlE = true;
				exercise = exercises[exercisesDivs.indexOf(event.currentTarget.id)];
				set();
			}
		});
	}

	for (i = 0; i < groupsDivs.length; i++) {
		$(("#" + groupsDivs[i])).click(function (event) {
			target = "#" + event.currentTarget.id;
			
			if ($(target).css("background-color") == "rgb(255, 176, 122)") {
				$(target).attr("style", false);
				hlG = false;
				group = "";
				set();
			} else if (!hlG) {
				$(target).css("background-color","#ffb07a");
				hlG = true;
				group = groups[groupsDivs.indexOf(event.currentTarget.id)];
				set();
			} else {
				clean(groupsDivs);
				hlG = false;
				$(target).css("background-color","#ffb07a");
				hlG = true;
				group = groups[groupsDivs.indexOf(event.currentTarget.id)];
				set();
			}
		});
	}

	function clean(divsList) {
		for (i = 0; i < groupsDivs.length; i++) {
			$(("#" + divsList[i])).attr("style", false);
		}
	}

	function set() {
		if (exercise != "" && group != "") {
			text.text("Exercise " + exercise + " will be sent to class " + group + ".");
			text.hide();
			text.fadeIn("slow");
			$('#submit-btn').attr('disabled', false);
		} else {
			text.text("");
			text.hide();
			text.fadeIn("slow");
			$('#submit-btn').attr('disabled', true);
		}
	}
	</script>
</body>
</html>